name: Taisun Gateway
description: |
  Taisun Gateway Container [taisun/gateway](https://hub.docker.com/r/taisun/gateway/)
  ============
  
  This will spinup a container on your system that houses 4 seperate running processes
    * OpenVPN udp endpoint
    * Squid Https proxy with password protection
    * Dynamic DNS updater
    * Certbot client for generating legitimate SSL certificates
  
  To use this service you will need to complete two seperate steps in advance:
    1. Generate a Dynamic DNS url [here](https://api.taisun.io/prod/genurl) it will output keys needed for this form
    2. Forward a series of ports on your router to your host machine
      * 4443/tcp needed for the Https proxy
      * 80/tcp needed for [certbot](https://certbot.eff.org/) to renew and generate SSL certificates
      * 1194/udp needed for the OpenVPN endpoint
  
  If you only want to use OpenVPN 1194/udp is the only port you need to forward, for the Https proxy both 4443/tcp and 80/tcp are needed.
form:
  - type: input
    format: text
    label: domain
    FormName: Taisun Domain
    placeholder: format <yourdomain>.taisun.io
  - type: input
    format: text
    label: dnskey
    FormName: Taisun DNSKey
    placeholder: IE debec485bcab4ab189a2315ae37fe196
  - type: input
    format: text
    label: squiduser
    FormName: Https Proxy User
    placeholder: myuser
  - type: input
    format: text
    label: squidpass
    FormName: Https Proxy Password
    placeholder: Make this complex it is a public service
  - type: input
    format: text
    label: email
    FormName: Email
    placeholder: This is used by certbot to send notifications of expiration

compose: |
  version: "3"
  services:
    taisungateway:
      image: taisun/gateway:latest
      container_name: taisun_gateway
      environment:
        - SERVERIP={{ domain }}
        - DNSKEY={{ dnskey }}
        - SQUIDUSER={{ squiduser }}
        - SQUIDPASS={{ squidpass }}
        - EMAIL={{ email }}
      restart: always
      network_mode: bridge
      cap_add:
        - NET_ADMIN
      volumes:
        - "openvpn:/etc/openvpn"
        - "ssl:/etc/letsencrypt"
      ports:
        - "80:80"
        - "4443:443"
        - "1194:1194/udp"
  volumes:
    openvpn:
    ssl:
    