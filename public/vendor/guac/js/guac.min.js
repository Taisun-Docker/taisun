!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Guacamole=t():e.Guacamole=t()}(this,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t){var n;(n=n||{}).ArrayBufferReader=function(e){var t=this;e.onblob=function(e){for(var n=window.atob(e),r=new ArrayBuffer(n.length),o=new Uint8Array(r),i=0;i<n.length;i++)o[i]=n.charCodeAt(i);t.ondata&&t.ondata(r)},e.onend=function(){t.onend&&t.onend()},this.ondata=null,this.onend=null},(n=n||{}).ArrayBufferWriter=function(e){var t=this;function r(t){for(var n="",r=0;r<t.byteLength;r++)n+=String.fromCharCode(t[r]);e.sendBlob(window.btoa(n))}e.onack=function(e){t.onack&&t.onack(e)},this.blobLength=n.ArrayBufferWriter.DEFAULT_BLOB_LENGTH,this.sendData=function(e){var n=new Uint8Array(e);if(n.length<=t.blobLength)r(n);else for(var o=0;o<n.length;o+=t.blobLength)r(n.subarray(o,o+t.blobLength))},this.sendEnd=function(){e.sendEnd()},this.onack=null},n.ArrayBufferWriter.DEFAULT_BLOB_LENGTH=6048,(n=n||{}).AudioContextFactory={singleton:null,getAudioContext:function(){var e=window.AudioContext||window.webkitAudioContext;if(e)try{return n.AudioContextFactory.singleton||(n.AudioContextFactory.singleton=new e),n.AudioContextFactory.singleton}catch(e){}return null}},(n=n||{}).AudioPlayer=function(){this.sync=function(){}},n.AudioPlayer.isSupportedType=function(e){return n.RawAudioPlayer.isSupportedType(e)},n.AudioPlayer.getSupportedTypes=function(){return n.RawAudioPlayer.getSupportedTypes()},n.AudioPlayer.getInstance=function(e,t){return n.RawAudioPlayer.isSupportedType(t)?new n.RawAudioPlayer(e,t):null},n.RawAudioPlayer=function(e,t){var r=n.RawAudioFormat.parse(t),o=n.AudioContextFactory.getAudioContext(),i=o.currentTime,a=new n.ArrayBufferReader(e),s=1===r.bytesPerSample?window.Int8Array:window.Int16Array,u=1===r.bytesPerSample?128:32768,c=[],l=function(){var e=function(e){if(e.length<=1)return e[0];var t=0;e.forEach((function(e){t+=e.length}));var n=0,r=new s(t);return e.forEach((function(e){r.set(e,n),n+=e.length})),r}(c);return e?(c=function(e){for(var t=Number.MAX_VALUE,n=e.length,o=Math.floor(e.length/r.channels),i=Math.floor(.02*r.rate),a=Math.max(r.channels*i,r.channels*(o-i));a<e.length;a+=r.channels){for(var u=0,c=0;c<r.channels;c++)u+=Math.abs(e[a+c]);u<=t&&(n=a+r.channels,t=u)}return n===e.length?[e]:[new s(e.buffer.slice(0,n*r.bytesPerSample)),new s(e.buffer.slice(n*r.bytesPerSample))]}(e),e=c.shift()):null};a.ondata=function(e){!function(e){c.push(new s(e))}(new s(e));var t=l();if(t){var n=o.currentTime;i<n&&(i=n);var a=o.createBufferSource();a.connect(o.destination),a.start||(a.start=a.noteOn),a.buffer=function(e){var t=e.length/r.channels,n=o.currentTime;i<n&&(i=n);for(var a=o.createBuffer(r.channels,t,r.rate),s=0;s<r.channels;s++)for(var c=a.getChannelData(s),l=s,d=0;d<t;d++)c[d]=e[l]/u,l+=r.channels;return a}(t),a.start(i),i+=t.length/r.channels/r.rate}},this.sync=function(){var e=o.currentTime;i=Math.min(i,e+.3)}},n.RawAudioPlayer.prototype=new n.AudioPlayer,n.RawAudioPlayer.isSupportedType=function(e){return!!n.AudioContextFactory.getAudioContext()&&null!==n.RawAudioFormat.parse(e)},n.RawAudioPlayer.getSupportedTypes=function(){return n.AudioContextFactory.getAudioContext()?["audio/L8","audio/L16"]:[]},(n=n||{}).AudioRecorder=function(){this.onclose=null,this.onerror=null},n.AudioRecorder.isSupportedType=function(e){return n.RawAudioRecorder.isSupportedType(e)},n.AudioRecorder.getSupportedTypes=function(){return n.RawAudioRecorder.getSupportedTypes()},n.AudioRecorder.getInstance=function(e,t){return n.RawAudioRecorder.isSupportedType(t)?new n.RawAudioRecorder(e,t):null},n.RawAudioRecorder=function(e,t){var r=this,o=n.RawAudioFormat.parse(t),i=n.AudioContextFactory.getAudioContext();navigator.mediaDevices||(navigator.mediaDevices={}),navigator.mediaDevices.getUserMedia||(navigator.mediaDevices.getUserMedia=(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia).bind(navigator));var a=new n.ArrayBufferWriter(e),s=1===o.bytesPerSample?window.Int8Array:window.Int16Array,u=1===o.bytesPerSample?128:32768,c=0,l=0,d=null,f=null,h=null,p=function(e){if(0===e)return 1;var t=Math.PI*e;return Math.sin(t)/t},g=function(e,t){for(var n,r,o=(e.length-1)*t,i=Math.floor(o)-3+1,a=Math.floor(o)+3,s=0,u=i;u<=a;u++)s+=(e[u]||0)*(-(r=3)<(n=o-u)&&n<r?p(n)*p(n/r):0);return s},v=function(){navigator.mediaDevices.getUserMedia({audio:!0},(function(e){(h=i.createScriptProcessor(2048,o.channels,o.channels)).connect(i.destination),h.onaudioprocess=function(e){a.sendData(function(e){var t=e.length;c+=t;var n=Math.round(c*o.rate/e.sampleRate)-l;l+=n;for(var r=new s(n*o.channels),i=0;i<o.channels;i++)for(var a=e.getChannelData(i),d=i,f=0;f<n;f++)r[d]=g(a,f/(n-1))*u,d+=o.channels;return r}(e.inputBuffer).buffer)},(f=i.createMediaStreamSource(e)).connect(h),d=e}),(function(){a.sendEnd(),r.onerror&&r.onerror()}))};a.onack=function(e){e.code!==n.Status.Code.SUCCESS||d?(!function(){if(f&&f.disconnect(),h&&h.disconnect(),d)for(var e=d.getTracks(),t=0;t<e.length;t++)e[t].stop();h=null,f=null,d=null,a.sendEnd()}(),a.onack=null,e.code===n.Status.Code.RESOURCE_CLOSED?r.onclose&&r.onclose():r.onerror&&r.onerror()):v()}},n.RawAudioRecorder.prototype=new n.AudioRecorder,n.RawAudioRecorder.isSupportedType=function(e){return!!n.AudioContextFactory.getAudioContext()&&null!==n.RawAudioFormat.parse(e)},n.RawAudioRecorder.getSupportedTypes=function(){return n.AudioContextFactory.getAudioContext()?["audio/L8","audio/L16"]:[]},(n=n||{}).BlobReader=function(e,t){var n,r=this,o=0;n=window.BlobBuilder?new BlobBuilder:window.WebKitBlobBuilder?new WebKitBlobBuilder:window.MozBlobBuilder?new MozBlobBuilder:new function(){var e=[];this.append=function(n){e.push(new Blob([n],{type:t}))},this.getBlob=function(){return new Blob(e,{type:t})}},e.onblob=function(t){for(var i=window.atob(t),a=new ArrayBuffer(i.length),s=new Uint8Array(a),u=0;u<i.length;u++)s[u]=i.charCodeAt(u);n.append(a),o+=a.byteLength,r.onprogress&&r.onprogress(a.byteLength),e.sendAck("OK",0)},e.onend=function(){r.onend&&r.onend()},this.getLength=function(){return o},this.getBlob=function(){return n.getBlob()},this.onprogress=null,this.onend=null},(n=n||{}).BlobWriter=function(e){var t=this,r=new n.ArrayBufferWriter(e);r.onack=function(e){t.onack&&t.onack(e)};this.sendBlob=function(e){var n=0,o=new FileReader,i=function(){if(n>=e.size)t.oncomplete&&t.oncomplete(e);else{var i=function(e,t,n){var r=(e.slice||e.webkitSlice||e.mozSlice).bind(e),o=n-t;if(o!==n){var i=r(t,o);if(i.size===o)return i}return r(t,n)}(e,n,n+r.blobLength);n+=r.blobLength,o.readAsArrayBuffer(i)}};o.onload=function(){r.sendData(o.result),r.onack=function(o){t.onack&&t.onack(o),o.isError()||(t.onprogress&&t.onprogress(e,n-r.blobLength),i())}},o.onerror=function(){t.onerror&&t.onerror(e,n,o.error)},i()},this.sendEnd=function(){r.sendEnd()},this.onack=null,this.onerror=null,this.onprogress=null,this.oncomplete=null},(n=n||{}).Client=function(e){var t=this,r=2,o=3,i=0,a=0,s=null,u={0:"butt",1:"round",2:"square"},c={0:"bevel",1:"miter",2:"round"},l=new n.Display,d={},f={},h={},p=[],g=[],v=[],y=new n.IntegerPool,m=[];function w(e){e!=i&&(i=e,t.onstatechange&&t.onstatechange(i))}function S(){return i==o||i==r}this.exportState=function(e){var t={currentState:i,currentTimestamp:a,layers:{}},n={};for(var r in d)n[r]=d[r];l.flush((function(){for(var r in n){var o=parseInt(r),i=n[r],a=i.toCanvas(),s={width:i.width,height:i.height};i.width&&i.height&&(s.url=a.toDataURL("image/png")),o>0&&(s.x=i.x,s.y=i.y,s.z=i.z,s.alpha=i.alpha,s.matrix=i.matrix,s.parent=T(i.parent)),t.layers[r]=s}e(t)}))},this.importState=function(e,t){var r,o;for(r in i=e.currentState,a=e.currentTimestamp,d)(o=parseInt(r))>0&&l.dispose(d[r]);for(r in d={},e.layers){o=parseInt(r);var s=e.layers[r],u=b(o);if(l.resize(u,s.width,s.height),s.url&&(l.setChannelMask(u,n.Layer.SRC),l.draw(u,0,0,s.url)),o>0&&s.parent>=0){var c=b(s.parent);l.move(u,c,s.x,s.y,s.z),l.shade(u,s.alpha);var f=s.matrix;l.distort(u,f[0],f[1],f[2],f[3],f[4],f[5])}}l.flush(t)},this.getDisplay=function(){return l},this.sendSize=function(t,n){S()&&e.sendMessage("size",t,n)},this.sendKeyEvent=function(t,n){S()&&e.sendMessage("key",n,t)},this.sendMouseState=function(t){if(S()){l.moveCursor(Math.floor(t.x),Math.floor(t.y));var n=0;t.left&&(n|=1),t.middle&&(n|=2),t.right&&(n|=4),t.up&&(n|=8),t.down&&(n|=16),e.sendMessage("mouse",Math.floor(t.x),Math.floor(t.y),n)}},this.createOutputStream=function(){var e=y.next();return m[e]=new n.OutputStream(t,e)},this.createAudioStream=function(n){var r=t.createOutputStream();return e.sendMessage("audio",r.index,n),r},this.createFileStream=function(n,r){var o=t.createOutputStream();return e.sendMessage("file",o.index,n,r),o},this.createPipeStream=function(n,r){var o=t.createOutputStream();return e.sendMessage("pipe",o.index,n,r),o},this.createClipboardStream=function(n){var r=t.createOutputStream();return e.sendMessage("clipboard",r.index,n),r},this.createArgumentValueStream=function(n,r){var o=t.createOutputStream();return e.sendMessage("argv",o.index,n,r),o},this.createObjectOutputStream=function(n,r,o){var i=t.createOutputStream();return e.sendMessage("put",n,i.index,r,o),i},this.requestObjectInputStream=function(t,n){S()&&e.sendMessage("get",t,n)},this.sendAck=function(t,n,r){S()&&e.sendMessage("ack",t,n,r)},this.sendBlob=function(t,n){S()&&e.sendMessage("blob",t,n)},this.endStream=function(t){S()&&(e.sendMessage("end",t),m[t]&&(y.free(t),delete m[t]))},this.onstatechange=null,this.onname=null,this.onerror=null,this.onaudio=null,this.onvideo=null,this.onargv=null,this.onclipboard=null,this.onfile=null,this.onfilesystem=null,this.onpipe=null,this.onsync=null;var b=function(e){var t=d[e];return t||(t=0===e?l.getDefaultLayer():e>0?l.createLayer():l.createBuffer(),d[e]=t),t},T=function(e){if(!e)return null;for(var t in d)if(e===d[t])return parseInt(t);return null};var I={"miter-limit":function(e,t){l.setMiterLimit(e,parseFloat(t))}},C={ack:function(e){var t=parseInt(e[0]),r=e[1],o=parseInt(e[2]),i=m[t];i&&(i.onack&&i.onack(new n.Status(o,r)),o>=256&&m[t]===i&&(y.free(t),delete m[t]))},arc:function(e){var t=b(parseInt(e[0])),n=parseInt(e[1]),r=parseInt(e[2]),o=parseInt(e[3]),i=parseFloat(e[4]),a=parseFloat(e[5]),s=parseInt(e[6]);l.arc(t,n,r,o,i,a,0!=s)},argv:function(e){var r=parseInt(e[0]),o=e[1],i=e[2];if(t.onargv){var a=g[r]=new n.InputStream(t,r);t.onargv(a,o,i)}else t.sendAck(r,"Receiving argument values unsupported",256)},audio:function(e){var r=parseInt(e[0]),o=e[1],i=g[r]=new n.InputStream(t,r),a=null;t.onaudio&&(a=t.onaudio(i,o)),a||(a=n.AudioPlayer.getInstance(i,o)),a?(f[r]=a,t.sendAck(r,"OK",0)):t.sendAck(r,"BAD TYPE",783)},blob:function(e){var t=parseInt(e[0]),n=e[1],r=g[t];r&&r.onblob&&r.onblob(n)},body:function(e){var r=parseInt(e[0]),o=v[r],i=parseInt(e[1]),a=e[2],s=e[3];if(o&&o.onbody){var u=g[i]=new n.InputStream(t,i);o.onbody(u,a,s)}else t.sendAck(i,"Receipt of body unsupported",256)},cfill:function(e){var t=parseInt(e[0]),n=b(parseInt(e[1])),r=parseInt(e[2]),o=parseInt(e[3]),i=parseInt(e[4]),a=parseInt(e[5]);l.setChannelMask(n,t),l.fillColor(n,r,o,i,a)},clip:function(e){var t=b(parseInt(e[0]));l.clip(t)},clipboard:function(e){var r=parseInt(e[0]),o=e[1];if(t.onclipboard){var i=g[r]=new n.InputStream(t,r);t.onclipboard(i,o)}else t.sendAck(r,"Clipboard unsupported",256)},close:function(e){var t=b(parseInt(e[0]));l.close(t)},copy:function(e){var t=b(parseInt(e[0])),n=parseInt(e[1]),r=parseInt(e[2]),o=parseInt(e[3]),i=parseInt(e[4]),a=parseInt(e[5]),s=b(parseInt(e[6])),u=parseInt(e[7]),c=parseInt(e[8]);l.setChannelMask(s,a),l.copy(t,n,r,o,i,s,u,c)},cstroke:function(e){var t=parseInt(e[0]),n=b(parseInt(e[1])),r=u[parseInt(e[2])],o=c[parseInt(e[3])],i=parseInt(e[4]),a=parseInt(e[5]),s=parseInt(e[6]),d=parseInt(e[7]),f=parseInt(e[8]);l.setChannelMask(n,t),l.strokeColor(n,r,o,i,a,s,d,f)},cursor:function(e){var t=parseInt(e[0]),n=parseInt(e[1]),r=b(parseInt(e[2])),o=parseInt(e[3]),i=parseInt(e[4]),a=parseInt(e[5]),s=parseInt(e[6]);l.setCursor(t,n,r,o,i,a,s)},curve:function(e){var t=b(parseInt(e[0])),n=parseInt(e[1]),r=parseInt(e[2]),o=parseInt(e[3]),i=parseInt(e[4]),a=parseInt(e[5]),s=parseInt(e[6]);l.curveTo(t,n,r,o,i,a,s)},disconnect:function(e){t.disconnect()},dispose:function(e){var t=parseInt(e[0]);if(t>0){var n=b(t);l.dispose(n),delete d[t]}else t<0&&delete d[t]},distort:function(e){var t=parseInt(e[0]),n=parseFloat(e[1]),r=parseFloat(e[2]),o=parseFloat(e[3]),i=parseFloat(e[4]),a=parseFloat(e[5]),s=parseFloat(e[6]);if(t>=0){var u=b(t);l.distort(u,n,r,o,i,a,s)}},error:function(e){var r=e[0],o=parseInt(e[1]);t.onerror&&t.onerror(new n.Status(o,r)),t.disconnect()},end:function(e){var t=parseInt(e[0]),n=g[t];n&&(n.onend&&n.onend(),delete g[t])},file:function(e){var r=parseInt(e[0]),o=e[1],i=e[2];if(t.onfile){var a=g[r]=new n.InputStream(t,r);t.onfile(a,o,i)}else t.sendAck(r,"File transfer unsupported",256)},filesystem:function(e){var r=parseInt(e[0]),o=e[1];if(t.onfilesystem){var i=v[r]=new n.Object(t,r);t.onfilesystem(i,o)}},identity:function(e){var t=b(parseInt(e[0]));l.setTransform(t,1,0,0,1,0,0)},img:function(e){var r=parseInt(e[0]),o=parseInt(e[1]),i=b(parseInt(e[2])),a=e[3],s=parseInt(e[4]),u=parseInt(e[5]),c=g[r]=new n.InputStream(t,r);l.setChannelMask(i,o),l.drawStream(i,s,u,c,a)},jpeg:function(e){var t=parseInt(e[0]),n=b(parseInt(e[1])),r=parseInt(e[2]),o=parseInt(e[3]),i=e[4];l.setChannelMask(n,t),l.draw(n,r,o,"data:image/jpeg;base64,"+i)},lfill:function(e){var t=parseInt(e[0]),n=b(parseInt(e[1])),r=b(parseInt(e[2]));l.setChannelMask(n,t),l.fillLayer(n,r)},line:function(e){var t=b(parseInt(e[0])),n=parseInt(e[1]),r=parseInt(e[2]);l.lineTo(t,n,r)},lstroke:function(e){var t=parseInt(e[0]),n=b(parseInt(e[1])),r=b(parseInt(e[2]));l.setChannelMask(n,t),l.strokeLayer(n,r)},mouse:function(e){var t=parseInt(e[0]),n=parseInt(e[1]);l.showCursor(!0),l.moveCursor(t,n)},move:function(e){var t=parseInt(e[0]),n=parseInt(e[1]),r=parseInt(e[2]),o=parseInt(e[3]),i=parseInt(e[4]);if(t>0&&n>=0){var a=b(t),s=b(n);l.move(a,s,r,o,i)}},name:function(e){t.onname&&t.onname(e[0])},nest:function(t){(function(t){var r=p[t];return null==r&&((r=p[t]=new n.Parser).oninstruction=e.oninstruction),r})(parseInt(t[0])).receive(t[1])},pipe:function(e){var r=parseInt(e[0]),o=e[1],i=e[2];if(t.onpipe){var a=g[r]=new n.InputStream(t,r);t.onpipe(a,o,i)}else t.sendAck(r,"Named pipes unsupported",256)},png:function(e){var t=parseInt(e[0]),n=b(parseInt(e[1])),r=parseInt(e[2]),o=parseInt(e[3]),i=e[4];l.setChannelMask(n,t),l.draw(n,r,o,"data:image/png;base64,"+i)},pop:function(e){var t=b(parseInt(e[0]));l.pop(t)},push:function(e){var t=b(parseInt(e[0]));l.push(t)},rect:function(e){var t=b(parseInt(e[0])),n=parseInt(e[1]),r=parseInt(e[2]),o=parseInt(e[3]),i=parseInt(e[4]);l.rect(t,n,r,o,i)},reset:function(e){var t=b(parseInt(e[0]));l.reset(t)},set:function(e){var t=b(parseInt(e[0])),n=e[1],r=e[2],o=I[n];o&&o(t,r)},shade:function(e){var t=parseInt(e[0]),n=parseInt(e[1]);if(t>=0){var r=b(t);l.shade(r,n)}},size:function(e){var t=parseInt(e[0]),n=b(t),r=parseInt(e[1]),o=parseInt(e[2]);l.resize(n,r,o)},start:function(e){var t=b(parseInt(e[0])),n=parseInt(e[1]),r=parseInt(e[2]);l.moveTo(t,n,r)},sync:function(n){var s=parseInt(n[0]);l.flush((function(){for(var t in f){var n=f[t];n&&n.sync()}s!==a&&(e.sendMessage("sync",s),a=s)})),i===r&&w(o),t.onsync&&t.onsync(s)},transfer:function(e){var t=b(parseInt(e[0])),r=parseInt(e[1]),o=parseInt(e[2]),i=parseInt(e[3]),a=parseInt(e[4]),s=parseInt(e[5]),u=b(parseInt(e[6])),c=parseInt(e[7]),d=parseInt(e[8]);3===s?l.put(t,r,o,i,a,u,c,d):5!==s&&l.transfer(t,r,o,i,a,u,c,d,n.Client.DefaultTransferFunction[s])},transform:function(e){var t=b(parseInt(e[0])),n=parseFloat(e[1]),r=parseFloat(e[2]),o=parseFloat(e[3]),i=parseFloat(e[4]),a=parseFloat(e[5]),s=parseFloat(e[6]);l.transform(t,n,r,o,i,a,s)},undefine:function(e){var t=parseInt(e[0]),n=v[t];n&&n.onundefine&&n.onundefine()},video:function(e){var r=parseInt(e[0]),o=b(parseInt(e[1])),i=e[2],a=g[r]=new n.InputStream(t,r),s=null;t.onvideo&&(s=t.onvideo(a,o,i)),s||(s=n.VideoPlayer.getInstance(a,o,i)),s?(h[r]=s,t.sendAck(r,"OK",0)):t.sendAck(r,"BAD TYPE",783)}};e.oninstruction=function(e,t){var n=C[e];n&&n(t)},this.disconnect=function(){5!=i&&4!=i&&(w(4),s&&window.clearInterval(s),e.sendMessage("disconnect"),e.disconnect(),w(5))},this.connect=function(t){w(1);try{e.connect(t)}catch(e){throw w(0),e}s=window.setInterval((function(){e.sendMessage("nop")}),5e3),w(r)}},n.Client.DefaultTransferFunction={0:function(e,t){t.red=t.green=t.blue=0},15:function(e,t){t.red=t.green=t.blue=255},3:function(e,t){t.red=e.red,t.green=e.green,t.blue=e.blue,t.alpha=e.alpha},5:function(e,t){},12:function(e,t){t.red=255&~e.red,t.green=255&~e.green,t.blue=255&~e.blue,t.alpha=e.alpha},10:function(e,t){t.red=255&~t.red,t.green=255&~t.green,t.blue=255&~t.blue},1:function(e,t){t.red=e.red&t.red,t.green=e.green&t.green,t.blue=e.blue&t.blue},14:function(e,t){t.red=255&~(e.red&t.red),t.green=255&~(e.green&t.green),t.blue=255&~(e.blue&t.blue)},7:function(e,t){t.red=e.red|t.red,t.green=e.green|t.green,t.blue=e.blue|t.blue},8:function(e,t){t.red=255&~(e.red|t.red),t.green=255&~(e.green|t.green),t.blue=255&~(e.blue|t.blue)},6:function(e,t){t.red=e.red^t.red,t.green=e.green^t.green,t.blue=e.blue^t.blue},9:function(e,t){t.red=255&~(e.red^t.red),t.green=255&~(e.green^t.green),t.blue=255&~(e.blue^t.blue)},4:function(e,t){t.red=~e.red&t.red&255,t.green=~e.green&t.green&255,t.blue=~e.blue&t.blue&255},13:function(e,t){t.red=255&(~e.red|t.red),t.green=255&(~e.green|t.green),t.blue=255&(~e.blue|t.blue)},2:function(e,t){t.red=e.red&~t.red&255,t.green=e.green&~t.green&255,t.blue=e.blue&~t.blue&255},11:function(e,t){t.red=255&(e.red|~t.red),t.green=255&(e.green|~t.green),t.blue=255&(e.blue|~t.blue)}},(n=n||{}).DataURIReader=function(e,t){var n=this,r="data:"+t+";base64,";e.onblob=function(e){r+=e},e.onend=function(){n.onend&&n.onend()},this.getURI=function(){return r},this.onend=null},(n=n||{}).Display=function(){var e=this,t=0,r=0,o=1,i=document.createElement("div");i.style.position="relative",i.style.width=t+"px",i.style.height=r+"px",i.style.transformOrigin=i.style.webkitTransformOrigin=i.style.MozTransformOrigin=i.style.OTransformOrigin=i.style.msTransformOrigin="0 0";var a=new n.Display.VisibleLayer(t,r),s=new n.Display.VisibleLayer(0,0);s.setChannelMask(n.Layer.SRC),i.appendChild(a.getElement()),i.appendChild(s.getElement());var u=document.createElement("div");u.style.position="relative",u.style.width=t*o+"px",u.style.height=r*o+"px",u.appendChild(i),this.cursorHotspotX=0,this.cursorHotspotY=0,this.cursorX=0,this.cursorY=0,this.onresize=null,this.oncursor=null;var c=[],l=[];function d(){for(var e=0;e<l.length;){var t=l[e];if(!t.isReady())break;t.flush(),e++}l.splice(0,e)}function f(e,t){this.isReady=function(){for(var e=0;e<t.length;e++)if(t[e].blocked)return!1;return!0},this.flush=function(){for(var n=0;n<t.length;n++)t[n].execute();e&&e()}}function h(e,t){var n=this;this.blocked=t,this.unblock=function(){n.blocked&&(n.blocked=!1,d())},this.execute=function(){e&&e()}}function p(e,t){var n=new h(e,t);return c.push(n),n}this.getElement=function(){return u},this.getWidth=function(){return t},this.getHeight=function(){return r},this.getDefaultLayer=function(){return a},this.getCursorLayer=function(){return s},this.createLayer=function(){var e=new n.Display.VisibleLayer(t,r);return e.move(a,0,0,0),e},this.createBuffer=function(){var e=new n.Layer(0,0);return e.autosize=1,e},this.flush=function(e){l.push(new f(e,c)),c=[],d()},this.setCursor=function(t,n,r,o,i,a,u){p((function(){e.cursorHotspotX=t,e.cursorHotspotY=n,s.resize(a,u),s.copy(r,o,i,a,u,0,0),e.moveCursor(e.cursorX,e.cursorY),e.oncursor&&e.oncursor(s.toCanvas(),t,n)}))},this.showCursor=function(e){var t=s.getElement(),n=t.parentNode;!1===e?n&&n.removeChild(t):n!==i&&i.appendChild(t)},this.moveCursor=function(t,n){s.translate(t-e.cursorHotspotX,n-e.cursorHotspotY),e.cursorX=t,e.cursorY=n},this.resize=function(n,s,c){p((function(){n.resize(s,c),n===a&&(t=s,r=c,i.style.width=t+"px",i.style.height=r+"px",u.style.width=t*o+"px",u.style.height=r*o+"px",e.onresize&&e.onresize(s,c))}))},this.drawImage=function(e,t,n,r){p((function(){e.drawImage(t,n,r)}))},this.drawBlob=function(e,t,n,r){var o;if(window.createImageBitmap){var i;o=p((function(){e.drawImage(t,n,i)}),!0),window.createImageBitmap(r).then((function(e){i=e,o.unblock()}))}else{var a=URL.createObjectURL(r);o=p((function(){s.width&&s.height&&e.drawImage(t,n,s),URL.revokeObjectURL(a)}),!0);var s=new Image;s.onload=o.unblock,s.onerror=o.unblock,s.src=a}},this.drawStream=function(t,r,o,i,a){var s;window.createImageBitmap?(s=new n.BlobReader(i,a)).onend=function(){e.drawBlob(t,r,o,s.getBlob())}:(s=new n.DataURIReader(i,a)).onend=function(){e.draw(t,r,o,s.getURI())}},this.draw=function(e,t,n,r){var o=p((function(){i.width&&i.height&&e.drawImage(t,n,i)}),!0),i=new Image;i.onload=o.unblock,i.onerror=o.unblock,i.src=r},this.play=function(e,t,n,r){var o=document.createElement("video");o.type=t,o.src=r,o.addEventListener("play",(function(){!function t(){e.drawImage(0,0,o),o.ended||window.setTimeout(t,20)}()}),!1),p(o.play)},this.transfer=function(e,t,n,r,o,i,a,s,u){p((function(){i.transfer(e,t,n,r,o,a,s,u)}))},this.put=function(e,t,n,r,o,i,a,s){p((function(){i.put(e,t,n,r,o,a,s)}))},this.copy=function(e,t,n,r,o,i,a,s){p((function(){i.copy(e,t,n,r,o,a,s)}))},this.moveTo=function(e,t,n){p((function(){e.moveTo(t,n)}))},this.lineTo=function(e,t,n){p((function(){e.lineTo(t,n)}))},this.arc=function(e,t,n,r,o,i,a){p((function(){e.arc(t,n,r,o,i,a)}))},this.curveTo=function(e,t,n,r,o,i,a){p((function(){e.curveTo(t,n,r,o,i,a)}))},this.close=function(e){p((function(){e.close()}))},this.rect=function(e,t,n,r,o){p((function(){e.rect(t,n,r,o)}))},this.clip=function(e){p((function(){e.clip()}))},this.strokeColor=function(e,t,n,r,o,i,a,s){p((function(){e.strokeColor(t,n,r,o,i,a,s)}))},this.fillColor=function(e,t,n,r,o){p((function(){e.fillColor(t,n,r,o)}))},this.strokeLayer=function(e,t,n,r,o){p((function(){e.strokeLayer(t,n,r,o)}))},this.fillLayer=function(e,t){p((function(){e.fillLayer(t)}))},this.push=function(e){p((function(){e.push()}))},this.pop=function(e){p((function(){e.pop()}))},this.reset=function(e){p((function(){e.reset()}))},this.setTransform=function(e,t,n,r,o,i,a){p((function(){e.setTransform(t,n,r,o,i,a)}))},this.transform=function(e,t,n,r,o,i,a){p((function(){e.transform(t,n,r,o,i,a)}))},this.setChannelMask=function(e,t){p((function(){e.setChannelMask(t)}))},this.setMiterLimit=function(e,t){p((function(){e.setMiterLimit(t)}))},this.dispose=function(e){p((function(){e.dispose()}))},this.distort=function(e,t,n,r,o,i,a){p((function(){e.distort(t,n,r,o,i,a)}))},this.move=function(e,t,n,r,o){p((function(){e.move(t,n,r,o)}))},this.shade=function(e,t){p((function(){e.shade(t)}))},this.scale=function(e){i.style.transform=i.style.WebkitTransform=i.style.MozTransform=i.style.OTransform=i.style.msTransform="scale("+e+","+e+")",o=e,u.style.width=t*o+"px",u.style.height=r*o+"px"},this.getScale=function(){return o},this.flatten=function(){var e=document.createElement("canvas");e.width=a.width,e.height=a.height;var t=e.getContext("2d");return function e(n,r,o){if(n.width>0&&n.height>0){var i=t.globalAlpha;t.globalAlpha*=n.alpha/255,t.drawImage(n.getCanvas(),r,o);for(var a=function(e){var t=[];for(var n in e.children)t.push(e.children[n]);return t.sort((function(e,t){var n=e.z-t.z;if(0!==n)return n;var r=e.getElement(),o=t.getElement().compareDocumentPosition(r);return o&Node.DOCUMENT_POSITION_PRECEDING?-1:o&Node.DOCUMENT_POSITION_FOLLOWING?1:0})),t}(n),s=0;s<a.length;s++){var u=a[s];e(u,r+u.x,o+u.y)}t.globalAlpha=i}}(a,0,0),e}},n.Display.VisibleLayer=function(e,t){n.Layer.apply(this,[e,t]);var r=this;this.__unique_id=n.Display.VisibleLayer.__next_id++,this.alpha=255,this.x=0,this.y=0,this.z=0,this.matrix=[1,0,0,1,0,0],this.parent=null,this.children={};var o=r.getCanvas();o.style.position="absolute",o.style.left="0px",o.style.top="0px";var i=document.createElement("div");i.appendChild(o),i.style.width=e+"px",i.style.height=t+"px",i.style.position="absolute",i.style.left="0px",i.style.top="0px",i.style.overflow="hidden";var a=this.resize;this.resize=function(e,t){i.style.width=e+"px",i.style.height=t+"px",a(e,t)},this.getElement=function(){return i};var s="translate(0px, 0px)",u="matrix(1, 0, 0, 1, 0, 0)";this.translate=function(e,t){r.x=e,r.y=t,s="translate("+e+"px,"+t+"px)",i.style.transform=i.style.WebkitTransform=i.style.MozTransform=i.style.OTransform=i.style.msTransform=s+" "+u},this.move=function(e,t,n,o){r.parent!==e&&(r.parent&&delete r.parent.children[r.__unique_id],r.parent=e,e.children[r.__unique_id]=r,e.getElement().appendChild(i));r.translate(t,n),r.z=o,i.style.zIndex=o},this.shade=function(e){r.alpha=e,i.style.opacity=e/255},this.dispose=function(){r.parent&&(delete r.parent.children[r.__unique_id],r.parent=null),i.parentNode&&i.parentNode.removeChild(i)},this.distort=function(e,t,n,o,a,c){r.matrix=[e,t,n,o,a,c],u="matrix("+e+","+t+","+n+","+o+","+a+","+c+")",i.style.transform=i.style.WebkitTransform=i.style.MozTransform=i.style.OTransform=i.style.msTransform=s+" "+u}},n.Display.VisibleLayer.__next_id=0,(n=n||{}).InputSink=function(){var e=this,t=document.createElement("textarea");t.style.position="fixed",t.style.outline="none",t.style.border="none",t.style.margin="0",t.style.padding="0",t.style.height="0",t.style.width="0",t.style.left="0",t.style.bottom="0",t.style.resize="none",t.style.background="transparent",t.style.color="transparent",t.addEventListener("keypress",(function(e){t.value=""}),!1),t.addEventListener("compositionend",(function(e){e.data&&(t.value="")}),!1),t.addEventListener("input",(function(e){e.data&&!e.isComposing&&(t.value="")}),!1),t.addEventListener("focus",(function(){window.setTimeout((function(){t.click(),t.select()}),0)}),!0),this.focus=function(){window.setTimeout((function(){t.focus()}),0)},this.getElement=function(){return t},document.addEventListener("keydown",(function(t){var n=document.activeElement;if(n&&n!==document.body){var r=n.getBoundingClientRect();if(r.left+r.width>0&&r.top+r.height>0)return}e.focus()}),!0)},(n=n||{}).InputStream=function(e,t){var n=this;this.index=t,this.onblob=null,this.onend=null,this.sendAck=function(t,r){e.sendAck(n.index,t,r)}},(n=n||{}).IntegerPool=function(){var e=this,t=[];this.next_int=0,this.next=function(){return t.length>0?t.shift():e.next_int++},this.free=function(e){t.push(e)}},(n=n||{}).JSONReader=function(e){var t=this,r=new n.StringReader(e),o="";this.getLength=function(){return o.length},this.getJSON=function(){return JSON.parse(o)},r.ontext=function(e){o+=e,t.onprogress&&t.onprogress(e.length)},r.onend=function(){t.onend&&t.onend()},this.onprogress=null,this.onend=null},(n=n||{}).Keyboard=function(e){var t=this,r="_GUAC_KEYBOARD_HANDLED_BY_"+n.Keyboard._nextID++;this.onkeydown=null,this.onkeyup=null;var o={keyupUnreliable:!1,altIsTypableOnly:!1,capsLockKeyupUnreliable:!1};navigator&&navigator.platform&&(navigator.platform.match(/ipad|iphone|ipod/i)?o.keyupUnreliable=!0:navigator.platform.match(/^mac/i)&&(o.altIsTypableOnly=!0,o.capsLockKeyupUnreliable=!0));var i=function(){var e=this;this.timestamp=(new Date).getTime(),this.defaultPrevented=!1,this.keysym=null,this.reliable=!1,this.getAge=function(){return(new Date).getTime()-e.timestamp}},a=function(e,n,r,a){i.apply(this),this.keyCode=e,this.keyIdentifier=n,this.key=r,this.location=a,this.keysym=S(r,a)||T(e,a),this.keyupReliable=!o.keyupUnreliable,this.keysym&&!w(this.keysym)&&(this.reliable=!0),!this.keysym&&I(e,n)&&(this.keysym=S(n,a,t.modifiers.shift)),t.modifiers.meta&&65511!==this.keysym&&65512!==this.keysym?this.keyupReliable=!1:65509===this.keysym&&o.capsLockKeyupUnreliable&&(this.keyupReliable=!1);var s=!t.modifiers.ctrl&&!o.altIsTypableOnly;(!t.modifiers.alt&&t.modifiers.ctrl||s&&t.modifiers.alt||t.modifiers.meta||t.modifiers.hyper)&&(this.reliable=!0),g[e]=this.keysym};a.prototype=new i;var s=function(e){i.apply(this),this.charCode=e,this.keysym=b(e),this.reliable=!0};s.prototype=new i;var u=function(e,n,r,o){i.apply(this),this.keyCode=e,this.keyIdentifier=n,this.key=r,this.location=o,this.keysym=T(e,o)||S(r,o),t.pressed[this.keysym]||(this.keysym=g[e]||this.keysym),this.reliable=!0};u.prototype=new i;var c=[],l={8:[65288],9:[65289],12:[65291,65291,65291,65461],13:[65293],16:[65505,65505,65506],17:[65507,65507,65508],18:[65513,65513,65027],19:[65299],20:[65509],27:[65307],32:[32],33:[65365,65365,65365,65465],34:[65366,65366,65366,65459],35:[65367,65367,65367,65457],36:[65360,65360,65360,65463],37:[65361,65361,65361,65460],38:[65362,65362,65362,65464],39:[65363,65363,65363,65462],40:[65364,65364,65364,65458],45:[65379,65379,65379,65456],46:[65535,65535,65535,65454],91:[65515],92:[65383],93:null,96:[65456],97:[65457],98:[65458],99:[65459],100:[65460],101:[65461],102:[65462],103:[65463],104:[65464],105:[65465],106:[65450],107:[65451],109:[65453],110:[65454],111:[65455],112:[65470],113:[65471],114:[65472],115:[65473],116:[65474],117:[65475],118:[65476],119:[65477],120:[65478],121:[65479],122:[65480],123:[65481],144:[65407],145:[65300],225:[65027]},d={Again:[65382],AllCandidates:[65341],Alphanumeric:[65328],Alt:[65513,65513,65027],Attn:[64782],AltGraph:[65027],ArrowDown:[65364],ArrowLeft:[65361],ArrowRight:[65363],ArrowUp:[65362],Backspace:[65288],CapsLock:[65509],Cancel:[65385],Clear:[65291],Convert:[65313],Copy:[64789],Crsel:[64796],CrSel:[64796],CodeInput:[65335],Compose:[65312],Control:[65507,65507,65508],ContextMenu:[65383],Delete:[65535],Down:[65364],End:[65367],Enter:[65293],EraseEof:[64774],Escape:[65307],Execute:[65378],Exsel:[64797],ExSel:[64797],F1:[65470],F2:[65471],F3:[65472],F4:[65473],F5:[65474],F6:[65475],F7:[65476],F8:[65477],F9:[65478],F10:[65479],F11:[65480],F12:[65481],F13:[65482],F14:[65483],F15:[65484],F16:[65485],F17:[65486],F18:[65487],F19:[65488],F20:[65489],F21:[65490],F22:[65491],F23:[65492],F24:[65493],Find:[65384],GroupFirst:[65036],GroupLast:[65038],GroupNext:[65032],GroupPrevious:[65034],FullWidth:null,HalfWidth:null,HangulMode:[65329],Hankaku:[65321],HanjaMode:[65332],Help:[65386],Hiragana:[65317],HiraganaKatakana:[65319],Home:[65360],Hyper:[65517,65517,65518],Insert:[65379],JapaneseHiragana:[65317],JapaneseKatakana:[65318],JapaneseRomaji:[65316],JunjaMode:[65336],KanaMode:[65325],KanjiMode:[65313],Katakana:[65318],Left:[65361],Meta:[65511,65511,65512],ModeChange:[65406],NumLock:[65407],PageDown:[65366],PageUp:[65365],Pause:[65299],Play:[64790],PreviousCandidate:[65342],PrintScreen:[65377],Redo:[65382],Right:[65363],RomanCharacters:null,Scroll:[65300],Select:[65376],Separator:[65452],Shift:[65505,65505,65506],SingleCandidate:[65340],Super:[65515,65515,65516],Tab:[65289],UIKeyInputDownArrow:[65364],UIKeyInputEscape:[65307],UIKeyInputLeftArrow:[65361],UIKeyInputRightArrow:[65363],UIKeyInputUpArrow:[65362],Up:[65362],Undo:[65381],Win:[65515],Zenkaku:[65320],ZenkakuHankaku:[65322]},f={65027:!0,65505:!0,65506:!0,65507:!0,65508:!0,65509:!0,65511:!0,65512:!0,65513:!0,65514:!0,65515:!0,65516:!0};this.modifiers=new n.Keyboard.ModifierState,this.pressed={};var h={},p={},g={},v=null,y=null,m=function(e,t){return e?e[t]||e[0]:null},w=function(e){return e>=0&&e<=255||16777216==(4294901760&e)};function S(e,t,n){if(!e)return null;var r,o=e.indexOf("U+");if(o>=0){var i=e.substring(o+2);r=String.fromCharCode(parseInt(i,16))}else{if(1!==e.length||3===t)return m(d[e],t);r=e}return!0===n?r=r.toUpperCase():!1===n&&(r=r.toLowerCase()),b(r.charCodeAt(0))}function b(e){return function(e){return e<=31||e>=127&&e<=159}(e)?65280|e:e>=0&&e<=255?e:e>=256&&e<=1114111?16777216|e:null}function T(e,t){return m(l[e],t)}var I=function(e,t){if(!t)return!1;var n=t.indexOf("U+");return-1===n||(e!==parseInt(t.substring(n+2),16)||(e>=65&&e<=90||e>=48&&e<=57))};this.press=function(e){if(null!==e){if(!t.pressed[e]&&(t.pressed[e]=!0,t.onkeydown)){var n=t.onkeydown(e);return p[e]=n,window.clearTimeout(v),window.clearInterval(y),f[e]||(v=window.setTimeout((function(){y=window.setInterval((function(){t.onkeyup(e),t.onkeydown(e)}),50)}),500)),n}return p[e]||!1}},this.release=function(e){t.pressed[e]&&(delete t.pressed[e],delete h[e],window.clearTimeout(v),window.clearInterval(y),null!==e&&t.onkeyup&&t.onkeyup(e))},this.type=function(e){for(var n=0;n<e.length;n++){var r=b(e.codePointAt?e.codePointAt(n):e.charCodeAt(n));t.press(r),t.release(r)}},this.reset=function(){for(var e in t.pressed)t.release(parseInt(e));c=[]};var C=function(e,n,r,o){var i;if(-1===r.indexOf(o.keysym))if(e&&!1===n)for(i=0;i<r.length;i++)t.release(r[i]);else if(!e&&n){for(i=0;i<r.length;i++)if(t.pressed[r[i]])return;var a=r[0];o.keysym&&(h[a]=!0),t.press(a)}},E=function(e,r){var o=n.Keyboard.ModifierState.fromKeyboardEvent(e);C(t.modifiers.alt,o.alt,[65513,65514,65027],r),C(t.modifiers.shift,o.shift,[65505,65506],r),C(t.modifiers.ctrl,o.ctrl,[65507,65508],r),C(t.modifiers.meta,o.meta,[65511,65512],r),C(t.modifiers.hyper,o.hyper,[65515,65516],r),t.modifiers=o},k=function(){for(var e in t.pressed)if(!h[e])return!1;return!0};function A(){var e,n=L();if(!n)return!1;do{e=n,n=L()}while(null!==n);return k()&&t.reset(),e.defaultPrevented}var L=function(){var e=c[0];if(!e)return null;if(!(e instanceof a))return e instanceof u&&!o.keyupUnreliable?(n=e.keysym)?(t.release(n),delete g[e.keyCode],e.defaultPrevented=!0,c.shift()):(t.reset(),e):c.shift();var n=null,r=[];if(e.reliable?(n=e.keysym,r=c.splice(0,1)):c[1]instanceof s?(n=c[1].keysym,r=c.splice(0,2)):c[1]&&(n=e.keysym,r=c.splice(0,1)),r.length>0){if(n){!function(e){t.modifiers.ctrl&&t.modifiers.alt&&(e>=65&&e<=90||e>=97&&e<=122||(e<=255||16777216==(4278190080&e))&&(t.release(65507),t.release(65508),t.release(65513),t.release(65514)))}(n);var i=!t.press(n);g[e.keyCode]=n,e.keyupReliable||t.release(n);for(var l=0;l<r.length;l++)r[l].defaultPrevented=i}return e}return null},R=function(e){return"location"in e?e.location:"keyLocation"in e?e.keyLocation:0},O=function(e){return!e[r]&&(e[r]=!0,!0)};this.listenTo=function(e){e.addEventListener("keydown",(function(e){if(t.onkeydown&&O(e)){var n;window.event?n=window.event.keyCode:e.which&&(n=e.which);var r=new a(n,e.keyIdentifier,e.key,R(e));E(e,r),229!==n&&(c.push(r),A()&&e.preventDefault())}}),!0),e.addEventListener("keypress",(function(e){if((t.onkeydown||t.onkeyup)&&O(e)){var n;window.event?n=window.event.keyCode:e.which&&(n=e.which);var r=new s(n);E(e,r),c.push(r),A()&&e.preventDefault()}}),!0),e.addEventListener("keyup",(function(e){if(t.onkeyup&&O(e)){var n;e.preventDefault(),window.event?n=window.event.keyCode:e.which&&(n=e.which);var r=new u(n,e.keyIdentifier,e.key,R(e));E(e,r),c.push(r),A()}}),!0);var n=function(n){(t.onkeydown||t.onkeyup)&&O(n)&&n.data&&!n.isComposing&&(e.removeEventListener("compositionend",r,!1),t.type(n.data))},r=function(r){(t.onkeydown||t.onkeyup)&&O(r)&&r.data&&(e.removeEventListener("input",n,!1),t.type(r.data))};e.addEventListener("input",n,!1),e.addEventListener("compositionend",r,!1)},e&&t.listenTo(e)},n.Keyboard._nextID=0,n.Keyboard.ModifierState=function(){this.shift=!1,this.ctrl=!1,this.alt=!1,this.meta=!1,this.hyper=!1},n.Keyboard.ModifierState.fromKeyboardEvent=function(e){var t=new n.Keyboard.ModifierState;return t.shift=e.shiftKey,t.ctrl=e.ctrlKey,t.alt=e.altKey,t.meta=e.metaKey,e.getModifierState&&(t.hyper=e.getModifierState("OS")||e.getModifierState("Super")||e.getModifierState("Hyper")||e.getModifierState("Win")),t},(n=n||{}).Layer=function(e,t){var r=this,o=document.createElement("canvas"),i=o.getContext("2d");i.save();var a=!0,s=!0,u=0,c={1:"destination-in",2:"destination-out",4:"source-in",6:"source-atop",8:"source-out",9:"destination-atop",10:"xor",11:"destination-over",12:"copy",14:"source-over",15:"lighter"},l=function(e,t){e=e||0,t=t||0;var n=64*Math.ceil(e/64),s=64*Math.ceil(t/64);if(o.width!==n||o.height!==s){var c=null;if(!a&&0!==o.width&&0!==o.height)(c=document.createElement("canvas")).width=Math.min(r.width,e),c.height=Math.min(r.height,t),c.getContext("2d").drawImage(o,0,0,c.width,c.height,0,0,c.width,c.height);var l=i.globalCompositeOperation;o.width=n,o.height=s,c&&i.drawImage(c,0,0,c.width,c.height,0,0,c.width,c.height),i.globalCompositeOperation=l,u=0,i.save()}else r.reset();r.width=e,r.height=t};function d(e,t,n,o){var i,a,s=n+e,u=o+t;i=s>r.width?s:r.width,a=u>r.height?u:r.height,r.resize(i,a)}this.autosize=!1,this.width=e,this.height=t,this.getCanvas=function(){return o},this.toCanvas=function(){var e=document.createElement("canvas");return e.width=r.width,e.height=r.height,e.getContext("2d").drawImage(r.getCanvas(),0,0),e},this.resize=function(e,t){e===r.width&&t===r.height||l(e,t)},this.drawImage=function(e,t,n){r.autosize&&d(e,t,n.width,n.height),i.drawImage(n,e,t),a=!1},this.transfer=function(e,t,o,s,u,c,l,f){var h=e.getCanvas();if(!(t>=h.width||o>=h.height)&&(t+s>h.width&&(s=h.width-t),o+u>h.height&&(u=h.height-o),0!==s&&0!==u)){r.autosize&&d(c,l,s,u);for(var p=e.getCanvas().getContext("2d").getImageData(t,o,s,u),g=i.getImageData(c,l,s,u),v=0;v<s*u*4;v+=4){var y=new n.Layer.Pixel(p.data[v],p.data[v+1],p.data[v+2],p.data[v+3]),m=new n.Layer.Pixel(g.data[v],g.data[v+1],g.data[v+2],g.data[v+3]);f(y,m),g.data[v]=m.red,g.data[v+1]=m.green,g.data[v+2]=m.blue,g.data[v+3]=m.alpha}i.putImageData(g,c,l),a=!1}},this.put=function(e,t,n,o,s,u,c){var l=e.getCanvas();if(!(t>=l.width||n>=l.height)&&(t+o>l.width&&(o=l.width-t),n+s>l.height&&(s=l.height-n),0!==o&&0!==s)){r.autosize&&d(u,c,o,s);var f=e.getCanvas().getContext("2d").getImageData(t,n,o,s);i.putImageData(f,u,c),a=!1}},this.copy=function(e,t,n,o,s,u,c){var l=e.getCanvas();t>=l.width||n>=l.height||(t+o>l.width&&(o=l.width-t),n+s>l.height&&(s=l.height-n),0!==o&&0!==s&&(r.autosize&&d(u,c,o,s),i.drawImage(l,t,n,o,s,u,c,o,s),a=!1))},this.moveTo=function(e,t){s&&(i.beginPath(),s=!1),r.autosize&&d(e,t,0,0),i.moveTo(e,t)},this.lineTo=function(e,t){s&&(i.beginPath(),s=!1),r.autosize&&d(e,t,0,0),i.lineTo(e,t)},this.arc=function(e,t,n,o,a,u){s&&(i.beginPath(),s=!1),r.autosize&&d(e,t,0,0),i.arc(e,t,n,o,a,u)},this.curveTo=function(e,t,n,o,a,u){s&&(i.beginPath(),s=!1),r.autosize&&d(a,u,0,0),i.bezierCurveTo(e,t,n,o,a,u)},this.close=function(){i.closePath(),s=!0},this.rect=function(e,t,n,o){s&&(i.beginPath(),s=!1),r.autosize&&d(e,t,n,o),i.rect(e,t,n,o)},this.clip=function(){i.clip(),s=!0},this.strokeColor=function(e,t,n,r,o,u,c){i.lineCap=e,i.lineJoin=t,i.lineWidth=n,i.strokeStyle="rgba("+r+","+o+","+u+","+c/255+")",i.stroke(),a=!1,s=!0},this.fillColor=function(e,t,n,r){i.fillStyle="rgba("+e+","+t+","+n+","+r/255+")",i.fill(),a=!1,s=!0},this.strokeLayer=function(e,t,n,r){i.lineCap=e,i.lineJoin=t,i.lineWidth=n,i.strokeStyle=i.createPattern(r.getCanvas(),"repeat"),i.stroke(),a=!1,s=!0},this.fillLayer=function(e){i.fillStyle=i.createPattern(e.getCanvas(),"repeat"),i.fill(),a=!1,s=!0},this.push=function(){i.save(),u++},this.pop=function(){u>0&&(i.restore(),u--)},this.reset=function(){for(;u>0;)i.restore(),u--;i.restore(),i.save(),i.beginPath(),s=!1},this.setTransform=function(e,t,n,r,o,a){i.setTransform(e,t,n,r,o,a)},this.transform=function(e,t,n,r,o,a){i.transform(e,t,n,r,o,a)},this.setChannelMask=function(e){i.globalCompositeOperation=c[e]},this.setMiterLimit=function(e){i.miterLimit=e},l(e,t),o.style.zIndex=-1},n.Layer.ROUT=2,n.Layer.ATOP=6,n.Layer.XOR=10,n.Layer.ROVER=11,n.Layer.OVER=14,n.Layer.PLUS=15,n.Layer.RIN=1,n.Layer.IN=4,n.Layer.OUT=8,n.Layer.RATOP=9,n.Layer.SRC=12,n.Layer.Pixel=function(e,t,n,r){this.red=e,this.green=t,this.blue=n,this.alpha=r},(n=n||{}).Mouse=function(e){var t=this;this.touchMouseThreshold=3,this.scrollThreshold=53,this.PIXELS_PER_LINE=18,this.PIXELS_PER_PAGE=16*this.PIXELS_PER_LINE,this.currentState=new n.Mouse.State(0,0,!1,!1,!1,!1,!1),this.onmousedown=null,this.onmouseup=null,this.onmousemove=null,this.onmouseout=null;var r=0,o=0;function i(e){e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.returnValue=!1}function a(){r=t.touchMouseThreshold}function s(e){var n=e.deltaY||-e.wheelDeltaY||-e.wheelDelta;if(n?1===e.deltaMode?n=e.deltaY*t.PIXELS_PER_LINE:2===e.deltaMode&&(n=e.deltaY*t.PIXELS_PER_PAGE):n=e.detail*t.PIXELS_PER_LINE,(o+=n)<=-t.scrollThreshold){do{t.onmousedown&&(t.currentState.up=!0,t.onmousedown(t.currentState)),t.onmouseup&&(t.currentState.up=!1,t.onmouseup(t.currentState)),o+=t.scrollThreshold}while(o<=-t.scrollThreshold);o=0}if(o>=t.scrollThreshold){do{t.onmousedown&&(t.currentState.down=!0,t.onmousedown(t.currentState)),t.onmouseup&&(t.currentState.down=!1,t.onmouseup(t.currentState)),o-=t.scrollThreshold}while(o>=t.scrollThreshold);o=0}i(e)}e.addEventListener("contextmenu",(function(e){i(e)}),!1),e.addEventListener("mousemove",(function(n){i(n),r?r--:(t.currentState.fromClientPosition(e,n.clientX,n.clientY),t.onmousemove&&t.onmousemove(t.currentState))}),!1),e.addEventListener("mousedown",(function(e){if(i(e),!r){switch(e.button){case 0:t.currentState.left=!0;break;case 1:t.currentState.middle=!0;break;case 2:t.currentState.right=!0}t.onmousedown&&t.onmousedown(t.currentState)}}),!1),e.addEventListener("mouseup",(function(e){if(i(e),!r){switch(e.button){case 0:t.currentState.left=!1;break;case 1:t.currentState.middle=!1;break;case 2:t.currentState.right=!1}t.onmouseup&&t.onmouseup(t.currentState)}}),!1),e.addEventListener("mouseout",(function(n){n||(n=window.event);for(var r=n.relatedTarget||n.toElement;r;){if(r===e)return;r=r.parentNode}i(n),(t.currentState.left||t.currentState.middle||t.currentState.right)&&(t.currentState.left=!1,t.currentState.middle=!1,t.currentState.right=!1,t.onmouseup&&t.onmouseup(t.currentState)),t.onmouseout&&t.onmouseout()}),!1),e.addEventListener("selectstart",(function(e){i(e)}),!1),e.addEventListener("touchmove",a,!1),e.addEventListener("touchstart",a,!1),e.addEventListener("touchend",a,!1),e.addEventListener("DOMMouseScroll",s,!1),e.addEventListener("mousewheel",s,!1),e.addEventListener("wheel",s,!1);var u=function(){var e=document.createElement("div");if(!("cursor"in e.style))return!1;try{e.style.cursor="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAAA1BMVEX///+nxBvIAAAACklEQVQI12NgAAAAAgAB4iG8MwAAAABJRU5ErkJggg==) 0 0, auto"}catch(e){return!1}return/\burl\([^()]*\)\s+0\s+0\b/.test(e.style.cursor||"")}();this.setCursor=function(t,n,r){if(u){var o=t.toDataURL("image/png");return e.style.cursor="url("+o+") "+n+" "+r+", auto",!0}return!1}},n.Mouse.State=function(e,t,n,r,o,i,a){var s=this;this.x=e,this.y=t,this.left=n,this.middle=r,this.right=o,this.up=i,this.down=a,this.fromClientPosition=function(e,t,n){s.x=t-e.offsetLeft,s.y=n-e.offsetTop;for(var r=e.offsetParent;r&&r!==document.body;)s.x-=r.offsetLeft-r.scrollLeft,s.y-=r.offsetTop-r.scrollTop,r=r.offsetParent;if(r){var o=document.body.scrollLeft||document.documentElement.scrollLeft,i=document.body.scrollTop||document.documentElement.scrollTop;s.x-=r.offsetLeft-o,s.y-=r.offsetTop-i}}},n.Mouse.Touchpad=function(e){var t=this;this.scrollThreshold=20*(window.devicePixelRatio||1),this.clickTimingThreshold=250,this.clickMoveThreshold=10*(window.devicePixelRatio||1),this.currentState=new n.Mouse.State(0,0,!1,!1,!1,!1,!1),this.onmousedown=null,this.onmouseup=null,this.onmousemove=null;var r=0,o=0,i=0,a=0,s=0,u={1:"left",2:"right",3:"middle"},c=!1,l=null;e.addEventListener("touchend",(function(e){if(e.preventDefault(),c&&0===e.touches.length){var n=(new Date).getTime(),o=u[r];t.currentState[o]&&(t.currentState[o]=!1,t.onmouseup&&t.onmouseup(t.currentState),l&&(window.clearTimeout(l),l=null)),n-a<=t.clickTimingThreshold&&s<t.clickMoveThreshold&&(t.currentState[o]=!0,t.onmousedown&&t.onmousedown(t.currentState),l=window.setTimeout((function(){t.currentState[o]=!1,t.onmouseup&&t.onmouseup(t.currentState),c=!1}),t.clickTimingThreshold)),l||(c=!1)}}),!1),e.addEventListener("touchstart",(function(e){if(e.preventDefault(),r=Math.min(e.touches.length,3),l&&(window.clearTimeout(l),l=null),!c){c=!0;var t=e.touches[0];o=t.clientX,i=t.clientY,a=(new Date).getTime(),s=0}}),!1),e.addEventListener("touchmove",(function(n){n.preventDefault();var u=n.touches[0],c=u.clientX-o,l=u.clientY-i;if(s+=Math.abs(c)+Math.abs(l),1===r){var d=1+s/((new Date).getTime()-a);t.currentState.x+=c*d,t.currentState.y+=l*d,t.currentState.x<0?t.currentState.x=0:t.currentState.x>=e.offsetWidth&&(t.currentState.x=e.offsetWidth-1),t.currentState.y<0?t.currentState.y=0:t.currentState.y>=e.offsetHeight&&(t.currentState.y=e.offsetHeight-1),t.onmousemove&&t.onmousemove(t.currentState),o=u.clientX,i=u.clientY}else if(2===r){var f;if(Math.abs(l)>=t.scrollThreshold)f=l>0?"down":"up",t.currentState[f]=!0,t.onmousedown&&t.onmousedown(t.currentState),t.currentState[f]=!1,t.onmouseup&&t.onmouseup(t.currentState),o=u.clientX,i=u.clientY}}),!1)},n.Mouse.Touchscreen=function(e){var t=this,r=!1,o=null,i=null,a=null,s=null;function u(e){t.currentState[e]||(t.currentState[e]=!0,t.onmousedown&&t.onmousedown(t.currentState))}function c(e){t.currentState[e]&&(t.currentState[e]=!1,t.onmouseup&&t.onmouseup(t.currentState))}function l(n,r){t.currentState.fromClientPosition(e,n,r),t.onmousemove&&t.onmousemove(t.currentState)}function d(e){var n=e.touches[0]||e.changedTouches[0],r=n.clientX-o,a=n.clientY-i;return Math.sqrt(r*r+a*a)>=t.clickMoveThreshold}function f(){window.clearTimeout(a),window.clearTimeout(s),r=!1}this.scrollThreshold=20*(window.devicePixelRatio||1),this.clickTimingThreshold=250,this.clickMoveThreshold=16*(window.devicePixelRatio||1),this.longPressThreshold=500,this.currentState=new n.Mouse.State(0,0,!1,!1,!1,!1,!1),this.onmousedown=null,this.onmouseup=null,this.onmousemove=null,e.addEventListener("touchend",(function(e){if(r)if(0===e.touches.length&&1===e.changedTouches.length){if(window.clearTimeout(s),c("left"),!d(e)&&(e.preventDefault(),!t.currentState.left)){var n=e.changedTouches[0];l(n.clientX,n.clientY),u("left"),a=window.setTimeout((function(){c("left"),f()}),t.clickTimingThreshold)}}else f()}),!1),e.addEventListener("touchstart",(function(e){1===e.touches.length?(e.preventDefault(),function(e){var t=e.touches[0];r=!0,o=t.clientX,i=t.clientY}(e),window.clearTimeout(a),s=window.setTimeout((function(){var t,n=e.touches[0];l(n.clientX,n.clientY),u(t="right"),c(t),f()}),t.longPressThreshold)):f()}),!1),e.addEventListener("touchmove",(function(e){if(r)if(d(e)&&window.clearTimeout(s),1===e.touches.length){if(t.currentState.left){e.preventDefault();var n=e.touches[0];l(n.clientX,n.clientY)}}else f()}),!1)},(n=(n=n||{})||{}).Object=function(e,t){var n=this,r={};this.index=t,this.onbody=function(e,t,n){var o=function(e){var t=r[e];if(!t)return null;var n=t.shift();return 0===t.length&&delete r[e],n}(n);o&&o(e,t)},this.onundefine=null,this.requestInputStream=function(t,o){o&&function(e,t){var n=r[e];n||(n=[],r[e]=n),n.push(t)}(t,o),e.requestObjectInputStream(n.index,t)},this.createOutputStream=function(t,r){return e.createObjectOutputStream(n.index,t,r)}},n.Object.ROOT_STREAM="/",n.Object.STREAM_INDEX_MIMETYPE="application/vnd.glyptodon.guacamole.stream-index+json",(n=n||{}).OnScreenKeyboard=function(e){var t=this,r={},o={},i=[],a=function(e,t){e.classList?e.classList.add(t):e.className+=" "+t},s=function(e,t){e.classList?e.classList.remove(t):e.className=e.className.replace(/([^ ]+)[ ]*/g,(function(e,n){return n===t?"":e}))},u=0,c=function(e,t,n,r){this.width=t,this.height=n,this.scale=function(o){e.style.width=t*o+"px",e.style.height=n*o+"px",r&&(e.style.lineHeight=n*o+"px",e.style.fontSize=o+"px")}},l=function(e){for(var t=0;t<e.length;t++){if(!(e[t]in r))return!1}return!0},d=function(e){var n=t.keys[e];if(!n)return null;for(var r=n.length-1;r>=0;r--){var o=n[r];if(l(o.requires))return o}return null},f=function(e,n){if(!o[e]){a(n,"guac-keyboard-pressed");var i=d(e);if(i.modifier){var u="guac-keyboard-modifier-"+v(i.modifier),c=r[i.modifier];c?(s(p,u),delete r[i.modifier],t.onkeyup&&t.onkeyup(c)):(a(p,u),r[i.modifier]=i.keysym,t.onkeydown&&t.onkeydown(i.keysym))}else t.onkeydown&&t.onkeydown(i.keysym);o[e]=!0}},h=function(e,n){if(o[e]){s(n,"guac-keyboard-pressed");var r=d(e);!r.modifier&&t.onkeyup&&t.onkeyup(r.keysym),o[e]=!1}},p=document.createElement("div");p.className="guac-keyboard",p.onselectstart=p.onmousemove=p.onmouseup=p.onmousedown=function(e){return u&&u--,e.stopPropagation(),!1},this.touchMouseThreshold=3,this.onkeydown=null,this.onkeyup=null,this.layout=new n.OnScreenKeyboard.Layout(e),this.getElement=function(){return p},this.resize=function(e){for(var n=Math.floor(10*e/t.layout.width)/10,r=0;r<i.length;r++){i[r].scale(n)}};var g=function(e,t){if(t instanceof Array){for(var r=[],o=0;o<t.length;o++)r.push(new n.OnScreenKeyboard.Key(t[o],e));return r}return"number"==typeof t?[new n.OnScreenKeyboard.Key({name:e,keysym:t})]:"string"==typeof t?[new n.OnScreenKeyboard.Key({name:e,title:t})]:[new n.OnScreenKeyboard.Key(t,e)]};this.keys=function(t){var n={};for(var r in e.keys)n[r]=g(r,t[r]);return n}(e.keys);var v=function(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").replace(/[^A-Za-z0-9]+/g,"-").toLowerCase()};!function e(n,r,o){var s,l=document.createElement("div");if(o&&a(l,"guac-keyboard-"+v(o)),r instanceof Array)for(a(l,"guac-keyboard-group"),s=0;s<r.length;s++)e(l,r[s]);else if(r instanceof Object){a(l,"guac-keyboard-group");var d=Object.keys(r).sort();for(s=0;s<d.length;s++){o=d[s];e(l,r[o],o)}}else if("number"==typeof r)a(l,"guac-keyboard-gap"),i.push(new c(l,r,r));else if("string"==typeof r){var p=r;1===p.length&&(p="0x"+p.charCodeAt(0).toString(16)),a(l,"guac-keyboard-key-container");var g=document.createElement("div");g.className="guac-keyboard-key guac-keyboard-key-"+v(p);var y=t.keys[r];if(y)for(s=0;s<y.length;s++){var m=y[s],w=document.createElement("div");w.className="guac-keyboard-cap",w.textContent=m.title;for(var S=0;S<m.requires.length;S++){var b=m.requires[S];a(w,"guac-keyboard-requires-"+v(b)),a(g,"guac-keyboard-uses-"+v(b))}g.appendChild(w)}l.appendChild(g),i.push(new c(l,t.layout.keyWidths[r]||1,1,!0));var T=function(e){e.preventDefault(),0===u&&h(r,g)};g.addEventListener("touchstart",(function(e){e.preventDefault(),u=t.touchMouseThreshold,f(r,g)}),!0),g.addEventListener("touchend",(function(e){e.preventDefault(),u=t.touchMouseThreshold,h(r,g)}),!0),g.addEventListener("mousedown",(function(e){e.preventDefault(),0===u&&f(r,g)}),!0),g.addEventListener("mouseup",T,!0),g.addEventListener("mouseout",T,!0)}n.appendChild(l)}(p,e.layout)},n.OnScreenKeyboard.Layout=function(e){this.language=e.language,this.type=e.type,this.keys=e.keys,this.layout=e.layout,this.width=e.width,this.keyWidths=e.keyWidths||{}},n.OnScreenKeyboard.Key=function(e,t){this.name=t||e.name,this.title=e.title||this.name,this.keysym=e.keysym||function(e){if(!e||1!==e.length)return null;var t=e.charCodeAt(0);return t>=0&&t<=255?t:t>=256&&t<=1114111?16777216|t:null}(this.title),this.modifier=e.modifier,this.requires=e.requires||[]},(n=n||{}).OutputStream=function(e,t){var n=this;this.index=t,this.onack=null,this.sendBlob=function(t){e.sendBlob(n.index,t)},this.sendEnd=function(){e.endStream(n.index)}},(n=n||{}).Parser=function(){var e=this,t="",n=[],r=-1,o=0;this.receive=function(i){for(o>4096&&r>=o&&(t=t.substring(o),r-=o,o=0),t+=i;r<t.length;){if(r>=o){var a=t.substring(o,r),s=t.substring(r,r+1);if(n.push(a),";"==s){var u=n.shift();null!=e.oninstruction&&e.oninstruction(u,n),n.length=0}else if(","!=s)throw new Error("Illegal terminator.");o=r+1}var c=t.indexOf(".",o);if(-1==c){o=t.length;break}var l=parseInt(t.substring(r+1,c));if(isNaN(l))throw new Error("Non-numeric character in element length.");r=(o=c+1)+l}},this.oninstruction=null},(n=n||{}).RawAudioFormat=function(e){this.bytesPerSample=e.bytesPerSample,this.channels=e.channels,this.rate=e.rate},n.RawAudioFormat.parse=function(e){var t,r=null,o=1;if("audio/L8;"===e.substring(0,9))e=e.substring(9),t=1;else{if("audio/L16;"!==e.substring(0,10))return null;e=e.substring(10),t=2}for(var i=e.split(","),a=0;a<i.length;a++){var s=i[a],u=s.indexOf("=");if(-1===u)return null;var c=s.substring(0,u),l=s.substring(u+1);switch(c){case"channels":o=parseInt(l);break;case"rate":r=parseInt(l);break;default:return null}}return null===r?null:new n.RawAudioFormat({bytesPerSample:t,channels:o,rate:r})},(n=n||{}).SessionRecording=function(e){var t=this,r=[],o=[],i=0,a=0,s=new n.SessionRecording._PlaybackTunnel,u=new n.Client(s),c=-1,l=null,d=null,f=null;u.connect(),u.getDisplay().showCursor(!1),e.oninstruction=function(e,s){var u=new n.SessionRecording._Frame.Instruction(e,s.slice());if(o.push(u),i+=u.getSize(),"sync"===e){var c=parseInt(s[0]),l=new n.SessionRecording._Frame(c,o);r.push(l),(1===r.length||i>=16384&&c-a>=5e3)&&(l.keyframe=!0,a=c,i=0),o=[],t.onprogress&&t.onprogress(t.getDuration())}};var h=function(e){return 0===r.length?0:e-r[0].timestamp},p=function(e){for(var t=r[e],n=0;n<t.instructions.length;n++){var o=t.instructions[n];s.receiveInstruction(o.opcode,o.args)}t.keyframe&&!t.clientState&&u.exportState((function(e){t.clientState=e}))},g=function e(n,o,i){v(),f=window.setTimeout((function(){var a;for(a=n;a>=0;a--){var s=r[a];if(a===c)break;if(s.clientState){u.importState(s.clientState);break}}a++;for(var l=(new Date).getTime();a<=n;a++){if((new Date).getTime()-l>=5)break;p(a)}c=a-1,t.onseek&&t.onseek(t.getPosition()),c!==n?e(n,o,Math.max(i-((new Date).getTime()-l),0)):o()}),i||0)},v=function(){window.clearTimeout(f)};this.onprogress=null,this.onplay=null,this.onpause=null,this.onseek=null,this.connect=function(t){e.connect(t)},this.disconnect=function(){e.disconnect()},this.getDisplay=function(){return u.getDisplay()},this.isPlaying=function(){return!!l},this.getPosition=function(){return-1===c?0:h(r[c].timestamp)},this.getDuration=function(){return 0===r.length?0:h(r[r.length-1].timestamp)},this.play=function(){if(!t.isPlaying()&&c+1<r.length){t.onplay&&t.onplay();var e=r[c+1];l=e.timestamp,d=(new Date).getTime(),function e(){if(c+1<r.length){var n=r[c+1].timestamp-l+d,o=Math.max(n-(new Date).getTime(),0);g(c+1,(function(){e()}),o)}else t.pause()}()}},this.seek=function(e,n){if(0!==r.length){var o=t.isPlaying();t.pause(),g(function e(t,n,o){if(t===n)return t;var i=Math.floor((t+n)/2),a=h(r[i].timestamp);return o<a&&i>t?e(t,i-1,o):o>a&&i<n?e(i+1,n,o):i}(0,r.length-1,e),(function(){o&&t.play(),n&&n()}))}},this.pause=function(){v(),t.isPlaying()&&(t.onpause&&t.onpause(),l=null,d=null)}},n.SessionRecording._Frame=function(e,t){this.keyframe=!1,this.timestamp=e,this.instructions=t,this.clientState=null},n.SessionRecording._Frame.Instruction=function(e,t){var n=this;this.opcode=e,this.args=t,this.getSize=function(){for(var e=n.opcode.length,t=0;t<n.args.length;t++)e+=n.args[t].length;return e}},n.SessionRecording._PlaybackTunnel=function(){var e=this;this.connect=function(e){},this.sendMessage=function(e){},this.disconnect=function(){},this.receiveInstruction=function(t,n){e.oninstruction&&e.oninstruction(t,n)}},(n=n||{}).Status=function(e,t){var n=this;this.code=e,this.message=t,this.isError=function(){return n.code<0||n.code>255}},n.Status.Code={SUCCESS:0,UNSUPPORTED:256,SERVER_ERROR:512,SERVER_BUSY:513,UPSTREAM_TIMEOUT:514,UPSTREAM_ERROR:515,RESOURCE_NOT_FOUND:516,RESOURCE_CONFLICT:517,RESOURCE_CLOSED:518,UPSTREAM_NOT_FOUND:519,UPSTREAM_UNAVAILABLE:520,SESSION_CONFLICT:521,SESSION_TIMEOUT:522,SESSION_CLOSED:523,CLIENT_BAD_REQUEST:768,CLIENT_UNAUTHORIZED:769,CLIENT_FORBIDDEN:771,CLIENT_TIMEOUT:776,CLIENT_OVERRUN:781,CLIENT_BAD_TYPE:783,CLIENT_TOO_MANY:797},n.Status.Code.fromHTTPCode=function(e){switch(e){case 400:return n.Status.Code.CLIENT_BAD_REQUEST;case 403:return n.Status.Code.CLIENT_FORBIDDEN;case 404:return n.Status.Code.RESOURCE_NOT_FOUND;case 429:return n.Status.Code.CLIENT_TOO_MANY;case 503:return n.Status.Code.SERVER_BUSY}return n.Status.Code.SERVER_ERROR},n.Status.Code.fromWebSocketCode=function(e){switch(e){case 1e3:return n.Status.Code.SUCCESS;case 1006:case 1015:return n.Status.Code.UPSTREAM_NOT_FOUND;case 1001:case 1012:case 1013:case 1014:return n.Status.Code.UPSTREAM_UNAVAILABLE}return n.Status.Code.SERVER_ERROR},(n=n||{}).StringReader=function(e){var t=this,r=new n.ArrayBufferReader(e),o=0,i=0;r.ondata=function(e){var n=function(e){for(var t="",n=new Uint8Array(e),r=0;r<n.length;r++){var a=n[r];0===o?127==(127|a)?t+=String.fromCharCode(a):223==(31|a)?(i=31&a,o=1):239==(15|a)?(i=15&a,o=2):247==(7|a)?(i=7&a,o=3):t+="":191==(63|a)?(i=i<<6|63&a,0===--o&&(t+=String.fromCharCode(i))):(o=0,t+="")}return t}(e);t.ontext&&t.ontext(n)},r.onend=function(){t.onend&&t.onend()},this.ontext=null,this.onend=null},(n=n||{}).StringWriter=function(e){var t=this,r=new n.ArrayBufferWriter(e),o=new Uint8Array(8192),i=0;function a(e){var t,n;if(e<=127)t=0,n=1;else if(e<=2047)t=192,n=2;else if(e<=65535)t=224,n=3;else{if(!(e<=2097151))return void a(65533);t=240,n=4}!function(e){if(i+e>=o.length){var t=new Uint8Array(2*(i+e));t.set(o),o=t}i+=e}(n);for(var r=i-1,s=1;s<n;s++)o[r--]=128|63&e,e>>=6;o[r]=t|e}r.onack=function(e){t.onack&&t.onack(e)},this.sendText=function(e){e.length&&r.sendData(function(e){for(var t=0;t<e.length;t++){a(e.charCodeAt(t))}if(i>0){var n=o.subarray(0,i);return i=0,n}}(e))},this.sendEnd=function(){r.sendEnd()},this.onack=null},(n=n||{}).Tunnel=function(){this.connect=function(e){},this.disconnect=function(){},this.sendMessage=function(e){},this.setState=function(e){e!==this.state&&(this.state=e,this.onstatechange&&this.onstatechange(e))},this.isConnected=function(){return this.state===n.Tunnel.State.OPEN||this.state===n.Tunnel.State.UNSTABLE},this.state=n.Tunnel.State.CONNECTING,this.receiveTimeout=15e3,this.unstableThreshold=1500,this.uuid=null,this.onerror=null,this.onstatechange=null,this.oninstruction=null},n.Tunnel.INTERNAL_DATA_OPCODE="",n.Tunnel.State={CONNECTING:0,OPEN:1,CLOSED:2,UNSTABLE:3},n.HTTPTunnel=function(e,t,r){var o=this,i=e+"?connect",a=e+"?read:",s=e+"?write:",u=1,c=0,l=u,d=!1,f="",h=!!t,p=null,g=null,v=null,y=r||{};function m(e,t){for(var n in t)e.setRequestHeader(n,t[n])}function w(){window.clearTimeout(p),window.clearTimeout(g),o.state===n.Tunnel.State.UNSTABLE&&o.setState(n.Tunnel.State.OPEN),p=window.setTimeout((function(){S(new n.Status(n.Status.Code.UPSTREAM_TIMEOUT,"Server timeout."))}),o.receiveTimeout),g=window.setTimeout((function(){o.setState(n.Tunnel.State.UNSTABLE)}),o.unstableThreshold)}function S(e){window.clearTimeout(p),window.clearTimeout(g),window.clearInterval(v),o.state!==n.Tunnel.State.CLOSED&&(e.code!==n.Status.Code.SUCCESS&&o.onerror&&(o.state!==n.Tunnel.State.CONNECTING&&e.code===n.Status.Code.RESOURCE_NOT_FOUND||o.onerror(e)),d=!1,o.setState(n.Tunnel.State.CLOSED))}function b(){if(o.isConnected())if(f.length>0){d=!0;var e=new XMLHttpRequest;e.open("POST",s+o.uuid),e.withCredentials=h,m(e,y),e.setRequestHeader("Content-type","application/octet-stream"),e.onreadystatechange=function(){4===e.readyState&&(w(),200!==e.status?T(e):b())},e.send(f),f=""}else d=!1}function T(e){var t=parseInt(e.getResponseHeader("Guacamole-Status-Code"));if(t){var r=e.getResponseHeader("Guacamole-Error-Message");S(new n.Status(t,r))}else e.status?S(new n.Status(n.Status.Code.fromHTTPCode(e.status),e.statusText)):S(new n.Status(n.Status.Code.UPSTREAM_NOT_FOUND))}this.sendMessage=function(){if(o.isConnected()&&0!==arguments.length){for(var e=n(arguments[0]),t=1;t<arguments.length;t++)e+=","+n(arguments[t]);f+=e+=";",d||b()}function n(e){var t=new String(e);return t.length+"."+t}};var I=0;function C(){var e=new XMLHttpRequest;return e.open("GET",a+o.uuid+":"+I++),e.withCredentials=h,m(e,y),e.send(null),e}this.connect=function(e){w(),o.setState(n.Tunnel.State.CONNECTING);var t=new XMLHttpRequest;t.onreadystatechange=function(){4===t.readyState&&(200===t.status?(w(),o.uuid=t.responseText,o.setState(n.Tunnel.State.OPEN),v=setInterval((function(){o.sendMessage("nop")}),500),function e(t){var n=null,r=null,i=0,a=-1,s=0,d=new Array;function f(){if(o.isConnected()){if(!(t.readyState<2)){var i;try{i=t.status}catch(e){i=200}if(r||200!==i||(r=C()),3===t.readyState||4===t.readyState){if(w(),l===u&&(3!==t.readyState||n?4===t.readyState&&n&&clearInterval(n):n=setInterval(f,30)),0===t.status)return void o.disconnect();if(200!==t.status)return void T(t);var c;try{c=t.responseText}catch(e){return}for(;a<c.length;){if(a>=s){var h=c.substring(s,a),p=c.substring(a,a+1);if(d.push(h),";"===p){var g=d.shift();o.oninstruction&&o.oninstruction(g,d),d.length=0}s=a+1}var v=c.indexOf(".",s);if(-1===v){s=c.length;break}var y=parseInt(c.substring(a+1,v));if(0===y){n&&clearInterval(n),t.onreadystatechange=null,t.abort(),r&&e(r);break}a=(s=v+1)+y}}}}else null!==n&&clearInterval(n)}t.onreadystatechange=l===u?function(){3===t.readyState&&++i>=2&&(l=c,t.onreadystatechange=f),f()}:f,f()}(C())):T(t))},t.open("POST",i,!0),t.withCredentials=h,m(t,y),t.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=UTF-8"),t.send(e)},this.disconnect=function(){S(new n.Status(n.Status.Code.SUCCESS,"Manually closed."))}},n.HTTPTunnel.prototype=new n.Tunnel,n.WebSocketTunnel=function(e){var t=this,r=null,o=null,i=null,a=null;if("ws:"!==e.substring(0,3)&&"wss:"!==e.substring(0,4)){var s={"http:":"ws:","https:":"wss:"}[window.location.protocol];if("/"===e.substring(0,1))e=s+"//"+window.location.host+e;else{var u=window.location.pathname.lastIndexOf("/"),c=window.location.pathname.substring(0,u+1);e=s+"//"+window.location.host+c+e}}function l(){window.clearTimeout(o),window.clearTimeout(i),t.state===n.Tunnel.State.UNSTABLE&&t.setState(n.Tunnel.State.OPEN),o=window.setTimeout((function(){d(new n.Status(n.Status.Code.UPSTREAM_TIMEOUT,"Server timeout."))}),t.receiveTimeout),i=window.setTimeout((function(){t.setState(n.Tunnel.State.UNSTABLE)}),t.unstableThreshold)}function d(e){window.clearTimeout(o),window.clearTimeout(i),window.clearInterval(a),t.state!==n.Tunnel.State.CLOSED&&(e.code!==n.Status.Code.SUCCESS&&t.onerror&&t.onerror(e),t.setState(n.Tunnel.State.CLOSED),r.close())}this.sendMessage=function(e){if(t.isConnected()&&0!==arguments.length){for(var n=i(arguments[0]),o=1;o<arguments.length;o++)n+=","+i(arguments[o]);n+=";",r.send(n)}function i(e){var t=new String(e);return t.length+"."+t}},this.connect=function(o){l(),t.setState(n.Tunnel.State.CONNECTING),(r=new WebSocket(e+"?"+o,"guacamole")).onopen=function(e){l(),a=setInterval((function(){t.sendMessage(n.Tunnel.INTERNAL_DATA_OPCODE,"ping",(new Date).getTime())}),500)},r.onclose=function(e){e.reason?d(new n.Status(parseInt(e.reason),e.reason)):e.code?d(new n.Status(n.Status.Code.fromWebSocketCode(e.code))):d(new n.Status(n.Status.Code.UPSTREAM_NOT_FOUND))},r.onmessage=function(e){l();var r,o=e.data,i=0,a=[];do{var s=o.indexOf(".",i);if(-1!==s)r=(i=s+1)+parseInt(o.substring(r+1,s));else d(new n.Status(n.Status.Code.SERVER_ERROR,"Incomplete instruction."));var u=o.substring(i,r),c=o.substring(r,r+1);if(a.push(u),";"===c){var f=a.shift();null===t.uuid&&(f===n.Tunnel.INTERNAL_DATA_OPCODE&&(t.uuid=a[0]),t.setState(n.Tunnel.State.OPEN)),f!==n.Tunnel.INTERNAL_DATA_OPCODE&&t.oninstruction&&t.oninstruction(f,a),a.length=0}i=r+1}while(i<o.length)}},this.disconnect=function(){d(new n.Status(n.Status.Code.SUCCESS,"Manually closed."))}},n.WebSocketTunnel.prototype=new n.Tunnel,n.ChainedTunnel=function(e){for(var t,r=this,o=[],i=null,a=0;a<arguments.length;a++)o.push(arguments[a]);function s(e){r.disconnect=e.disconnect,r.sendMessage=e.sendMessage;var a=function(t){if(t&&t.code===n.Status.Code.UPSTREAM_TIMEOUT)return o=[],null;var r=o.shift();return r&&(e.onerror=null,e.oninstruction=null,e.onstatechange=null,s(r)),r};function u(){e.onstatechange=r.onstatechange,e.oninstruction=r.oninstruction,e.onerror=r.onerror,r.uuid=e.uuid,i=e}e.onstatechange=function(e){switch(e){case n.Tunnel.State.OPEN:u(),r.onstatechange&&r.onstatechange(e);break;case n.Tunnel.State.CLOSED:!a()&&r.onstatechange&&r.onstatechange(e)}},e.oninstruction=function(e,t){u(),r.oninstruction&&r.oninstruction(e,t)},e.onerror=function(e){!a(e)&&r.onerror&&r.onerror(e)},e.connect(t)}this.connect=function(e){t=e;var a=i||o.shift();a?s(a):r.onerror&&r.onerror(n.Status.Code.SERVER_ERROR,"No tunnels to try.")}},n.ChainedTunnel.prototype=new n.Tunnel,n.StaticHTTPTunnel=function(e,t,r){var o=this,i=null,a=r||{};this.sendMessage=function(e){},this.connect=function(r){o.disconnect(),o.setState(n.Tunnel.State.CONNECTING),(i=new XMLHttpRequest).open("GET",e),i.withCredentials=!!t,function(e,t){for(var n in t)e.setRequestHeader(n,t[n])}(i,a),i.responseType="text",i.send(null);var s=0,u=new n.Parser;u.oninstruction=function(e,t){o.oninstruction&&o.oninstruction(e,t)},i.onreadystatechange=function(){if(3===i.readyState||4===i.readyState){o.setState(n.Tunnel.State.OPEN);var e=i.responseText,t=e.length;s<t&&(u.receive(e.substring(s)),s=t)}4===i.readyState&&o.disconnect()},i.onerror=function(){o.onerror&&o.onerror(new n.Status(n.Status.Code.fromHTTPCode(i.status),i.statusText)),o.disconnect()}},this.disconnect=function(){i&&(i.abort(),i=null),o.setState(n.Tunnel.State.CLOSED)}},n.StaticHTTPTunnel.prototype=new n.Tunnel,(n=n||{}).API_VERSION="1.1.0",(n=n||{}).VideoPlayer=function(){this.sync=function(){}},n.VideoPlayer.isSupportedType=function(e){return!1},n.VideoPlayer.getSupportedTypes=function(){return[]},n.VideoPlayer.getInstance=function(e,t,n){return null},e.exports=n}])}));